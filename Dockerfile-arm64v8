FROM arm64v8/debian:bullseye-slim

# Set build arguments for flexibility
ARG ROOT_PASSWORD

# Install required packages and clean up
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        nano \
        openssh-server \
        python3 \
        python3-pip && \
    rm -rf /var/lib/apt/lists/*

# Configure SSH
RUN echo "root:${ROOT_PASSWORD}" | chpasswd && \
    sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config && \
    echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config && \
    echo 'PasswordAuthentication yes' >> /etc/ssh/sshd_config

# Expose only the necessary port
EXPOSE 2222

# Add customizations
RUN : > /etc/motd
COPY ./scripts_bash/banners.sh /etc/profile.d/
COPY scripts_bash/issue /etc/issue
RUN chmod +x /etc/profile.d/banners.sh

# Generate SSH host keys
RUN ssh-keygen -A

# Copy application files
COPY ./niveaux /app

# Set the default command
CMD ["/usr/sbin/sshd", "-D"]
