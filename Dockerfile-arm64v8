FROM arm64v8/debian:bullseye-slim

# Définir des arguments de build pour plus de flexibilité
ARG ROOT_PASSWORD

# Installer les paquets requis et nettoyer
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        nano \
        openssh-server \
        python3 \
        python3-pip && \
    rm -rf /var/lib/apt/lists/*

# Configurer SSH
RUN echo "root:${ROOT_PASSWORD}" | chpasswd && \
    sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config && \
    echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config && \
    echo 'PasswordAuthentication yes' >> /etc/ssh/sshd_config

# N'exposer que le port nécessaire
EXPOSE 2222

# Ajouter les personnalisations
RUN : > /etc/motd
COPY ./scripts_bash/banners.sh /etc/profile.d/
COPY scripts_bash/issue /etc/issue
RUN chmod +x /etc/profile.d/banners.sh

# Générer les clés SSH hôtes
RUN ssh-keygen -A

# Copier les fichiers de l'application
COPY ./niveaux /app

# Spécifier la commande par défaut
CMD ["/usr/sbin/sshd", "-D"]
